#!/bin/bash
# Post-edit hook: Type check
# Always exit 0, use JSON {"decision":"block","reason":"..."} to report errors

INPUT=$(cat)
FILE=$(echo "$INPUT" | jq -r '.tool_input.file_path // empty')

[ -z "$FILE" ] && exit 0
[ ! -f "$FILE" ] && exit 0
echo "$FILE" | grep -qE '\.({{{EXTENSIONS}}})$' || exit 0

# Skip .claude directory entirely
echo "$FILE" | grep -qE '/\.claude/' && exit 0

TSC_OUTPUT=$({{{TYPE_COMMAND}}} 2>&1 | head -20)
if [ -n "$TSC_OUTPUT" ]; then
	jq -n --arg reason "TypeScript errors:
$TSC_OUTPUT

FIX THESE BEFORE RESPONDING." '{"decision":"block","reason":$reason}'
	exit 0
fi

echo '{}'
exit 0
