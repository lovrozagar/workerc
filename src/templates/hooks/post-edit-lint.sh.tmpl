#!/bin/bash
# Post-edit hook: Lint check
# Always exit 0, use JSON {"decision":"block","reason":"..."} to report errors

INPUT=$(cat)
FILE=$(echo "$INPUT" | jq -r '.tool_input.file_path // empty')

[ -z "$FILE" ] && exit 0
[ ! -f "$FILE" ] && exit 0

# Only check files the linter cares about
echo "$FILE" | grep -qE '\.({{{EXTENSIONS}}})$' || exit 0

# Skip .claude directory entirely
echo "$FILE" | grep -qE '/\.claude/' && exit 0

LINT_OUTPUT=$({{{LINT_COMMAND}}} "$FILE" 2>&1)
EXIT_CODE=$?

# Success or file excluded from linter config
if [ $EXIT_CODE -eq 0 ]; then
	echo '{}'
	exit 0
fi
echo "$LINT_OUTPUT" | grep -q "No files were processed" && { echo '{}'; exit 0; }

jq -n --arg reason "Lint issues in $FILE:
$LINT_OUTPUT

FIX THESE BEFORE RESPONDING." '{"decision":"block","reason":$reason}'
exit 0
